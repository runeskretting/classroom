{% extends "base.html" %}

{% block title %}My Progress - Python Classroom{% endblock %}

{% block content %}
<div class="progress-page">
    <div class="progress-header">
        <h1>My Progress</h1>
        <p class="student-name">{{ student_name }}</p>
    </div>

    {% if progress.completed %}
        <div class="completion-banner">
            <h2>ðŸŽ‰ Congratulations!</h2>
            <p>You have successfully completed all modules of the Python Classroom!</p>
            <p class="completion-date">Completed: {{ progress.completed_at }}</p>
        </div>
    {% else %}
        <div class="current-progress">
            <h3>Currently on: Day {{ progress.current_module }}</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (progress.current_module - 1) / 100 * 100 }}%"></div>
            </div>
            <p class="progress-text">{{ progress.current_module - 1 }} of 100 days completed</p>
        </div>
    {% endif %}

    <div class="modules-progress">
        {% for module_id in modules.keys()|sort %}
            {% set module = modules[module_id] %}
            {% set module_progress = progress.modules.get(module_id, {'quiz_passed': False, 'project_passed': False, 'quiz_score': 0, 'attempts': 0}) %}
            {% set is_accessible = module_id <= progress.current_module %}
            {% set is_complete = module_progress.quiz_passed and module_progress.project_passed %}

            <div class="module-progress-card {% if is_complete %}completed{% elif not is_accessible %}locked{% endif %}">
                <div class="module-progress-header">
                    <div class="module-number-badge">
                        {% if is_complete %}
                            <span class="checkmark">âœ“</span>
                        {% elif not is_accessible %}
                            <span class="lock">ðŸ”’</span>
                        {% else %}
                            {{ module_id }}
                        {% endif %}
                    </div>
                    <div>
                        <h3>{{ module.title }}</h3>
                        <p class="module-objective">{{ module.objective }}</p>
                    </div>
                </div>

                <div class="module-progress-details">
                    <div class="progress-item">
                        <span class="progress-label">Quiz:</span>
                        {% if module_progress.quiz_passed %}
                            <span class="badge badge-success">âœ“ Passed ({{ module_progress.quiz_score }}%)</span>
                        {% elif is_accessible %}
                            <span class="badge badge-pending">Not Completed</span>
                        {% else %}
                            <span class="badge badge-locked">Locked</span>
                        {% endif %}
                    </div>

                    <div class="progress-item">
                        <span class="progress-label">Project:</span>
                        {% if module_progress.project_passed %}
                            <span class="badge badge-success">âœ“ Passed</span>
                        {% elif module_progress.attempts > 0 %}
                            <span class="badge badge-warning">{{ module_progress.attempts }} attempt(s)</span>
                        {% elif is_accessible %}
                            <span class="badge badge-pending">Not Submitted</span>
                        {% else %}
                            <span class="badge badge-locked">Locked</span>
                        {% endif %}
                    </div>
                </div>

                <div class="module-progress-actions">
                    {% if is_accessible %}
                        {% if not is_complete %}
                            <a href="{{ url_for('module', module_id=module_id) }}" class="btn btn-primary btn-small">
                                {% if module_progress.quiz_passed %}
                                    Submit Project
                                {% else %}
                                    Start Module
                                {% endif %}
                            </a>
                        {% else %}
                            <a href="{{ url_for('module', module_id=module_id) }}" class="btn btn-secondary btn-small">
                                Review
                            </a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="stats-section">
        <h3>Statistics</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ progress.current_module - 1 }}</div>
                <div class="stat-label">Days Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    {% set total_attempts = namespace(value=0) %}
                    {% for module_id, module_data in progress.modules.items() %}
                        {% set total_attempts.value = total_attempts.value + module_data.attempts %}
                    {% endfor %}
                    {{ total_attempts.value }}
                </div>
                <div class="stat-label">Total Attempts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    {% set quizzes_passed = namespace(value=0) %}
                    {% for module_id, module_data in progress.modules.items() %}
                        {% if module_data.quiz_passed %}
                            {% set quizzes_passed.value = quizzes_passed.value + 1 %}
                        {% endif %}
                    {% endfor %}
                    {{ quizzes_passed.value }}
                </div>
                <div class="stat-label">Quizzes Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    {% set projects_passed = namespace(value=0) %}
                    {% for module_id, module_data in progress.modules.items() %}
                        {% if module_data.project_passed %}
                            {% set projects_passed.value = projects_passed.value + 1 %}
                        {% endif %}
                    {% endfor %}
                    {{ projects_passed.value }}
                </div>
                <div class="stat-label">Projects Passed</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
